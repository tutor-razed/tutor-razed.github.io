<?php ?>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Letter Countdown</title>

<style>
body {
    font-family: 'Trebuchet MS', sans-serif;
    background: linear-gradient(135deg, #1b1b3a, #0f3460);
    color: #fff;
    text-align: center;
    padding: 20px;
}

.hidden { display: none; }

h1 {
    font-size: 3rem;
    color: #ffcc00;
    text-shadow: 0 0 15px orange;
}

input, select, button {
    font-size: 1.1rem;
    padding: 10px;
    margin: 6px;
    border-radius: 6px;
    border: none;
}

button {
    cursor: pointer;
    background: linear-gradient(to bottom, #ff9800, #ff5722);
    color: #000;
    font-weight: bold;
}
button:hover { transform: scale(1.05); }

#puzzle {
    font-size: 2.3rem;
    letter-spacing: 6px;
    margin: 25px;
    line-height: 3.2rem;
}

.word-gap { margin-right: 30px; }

.punctuation {
    color: #00ffff;
    font-weight: bold;
}

.keyboard {
    max-width: 720px;
    margin: 20px auto;
}
.keyboard button {
    width: 48px;
    height: 48px;
    margin: 5px;
    font-weight: bold;
    font-size: 1.1rem;
}

.correct {
    background: linear-gradient(#00ff99, #00cc66) !important;
}
.wrong {
    background: linear-gradient(#ff0033, #990000) !important;
    color: white;
}

#fuse-container {
    width: 320px;
    height: 22px;
    border-radius: 12px;
    border: 3px solid #fff;
    margin: 20px auto;
    background: #333;
    overflow: hidden;
}

#fuse {
    height: 100%;
    background: linear-gradient(90deg, yellow, orange, red);
    width: 100%;
    animation: flicker 0.5s infinite alternate;
    transition: width 0.4s linear;
}

@keyframes flicker {
    from { filter: brightness(1); }
    to { filter: brightness(1.3); }
}

#bomb {
    font-size: 5rem;
    animation: shake 0.6s infinite;
}

@keyframes shake {
    0% { transform: rotate(0deg); }
    25% { transform: rotate(-3deg); }
    50% { transform: rotate(3deg); }
    75% { transform: rotate(-3deg); }
    100% { transform: rotate(0deg); }
}

/* BOOM */
#boomScreen {
    animation: flashRed 0.4s infinite alternate;
}
@keyframes flashRed {
    from { background: black; }
    to { background: darkred; }
}
#boom {
    font-size: 6rem;
    color: yellow;
    text-shadow: 0 0 30px red;
}

/* WIN */
#winScreen {
    animation: flashGreen 0.4s infinite alternate;
}
@keyframes flashGreen {
    from { background: #003300; }
    to { background: #006600; }
}
#win {
    font-size: 5rem;
    color: #00ffcc;
    text-shadow: 0 0 25px gold;
}

#error {
    color: #ff6666;
    font-weight: bold;
}
</style>
</head>

<body>

<h1>üí£ LETTER COUNTDOWN üí£</h1>

<div id="setup">
    <h2>Player A: Enter Secret Phrase</h2>
    <input type="password" id="secretInput" placeholder="Letters only (min 5)" list="phraseSuggestions">
    <datalist id="phraseSuggestions"></datalist>
    <br>
    <button type="button" id="randomPhraseBtn">üé≤ Random phrase</button>
    <button type="button" id="nextPhraseBtn">‚û°Ô∏è Next phrase</button>

    <br>
    <label><input type="checkbox" id="toggleView"> Show phrase</label>
    <br>
    <label>Wrong guesses allowed:</label>
    <select id="maxWrong">
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="15">15</option>
        <option value="26">26</option>
    </select>
    <br>
    <button onclick="startGame()">üöÄ Start Game</button>
    <div id="error"></div>
</div>

<div id="game" class="hidden">
    <div id="fuse-container"><div id="fuse"></div></div>
    <div id="bomb">üí£</div>
    <div id="puzzle"></div>
    <div class="keyboard" id="keyboard"></div>
    <button onclick="resetGame()">üîÅ Reset Game</button>
</div>

<div id="boomScreen" class="hidden">
    <div id="boom">üí• BOOM üí•</div>
    <p>The phrase was:</p>
    <h2 id="boomPhrase"></h2>
    <button onclick="resetGame()">‚ñ∂ PLAY AGAIN</button>
</div>

<div id="winScreen" class="hidden">
    <div id="win">üéâ YOU SAVED THE BOMB üéâ</div>
    <p>The phrase was:</p>
    <h2 id="winPhrase"></h2>
    <button onclick="resetGame()">‚ñ∂ PLAY AGAIN</button>
</div>

<script>
let phrase = "";
let guessed = [];
let wrong = 0;
let maxWrong = 5;
let letterButtons = {};
const allowedPunctuation = [".", ",", "?", "!", "'"];

// Phrase bank for students (edit freely)
const PHRASE_BANK = [
  "CAT",
  "DOG",
  "RED BOAT",
  "BIG TREE",
  "I CAN DO IT",
  "WE ARE FRIENDS",
  "LET'S GO",
  "DON'T STOP",
  "READ A BOOK",
  "PACK A LUNCH"
];

let phraseIndex = 0;

function pickRandomPhrase(){
  return PHRASE_BANK[Math.floor(Math.random() * PHRASE_BANK.length)];
}

function pickNextPhrase(){
  const p = PHRASE_BANK[phraseIndex % PHRASE_BANK.length];
  phraseIndex++;
  return p;
}

function populateSuggestions(){
  const dl = document.getElementById("phraseSuggestions");
  if (!dl) return;
  dl.innerHTML = PHRASE_BANK.map(p => `<option value="${p}"></option>`).join("");
}


document.getElementById("toggleView").addEventListener("change", e => {
    document.getElementById("secretInput").type =
        e.target.checked ? "text" : "password";
});

document.getElementById("randomPhraseBtn").addEventListener("click", () => {
  document.getElementById("secretInput").value = pickRandomPhrase();
  document.getElementById("secretInput").focus();
});

document.getElementById("nextPhraseBtn").addEventListener("click", () => {
  document.getElementById("secretInput").value = pickNextPhrase();
  document.getElementById("secretInput").focus();
});


document.addEventListener("keydown", e => {
    if (!document.getElementById("game").classList.contains("hidden")) {
        let key = e.key.toUpperCase();
        if (key >= "A" && key <= "Z" && letterButtons[key] && !letterButtons[key].disabled) {
            guess(key, letterButtons[key]);
        }
    }
});

function startGame() {
    const input = document.getElementById("secretInput").value.toUpperCase();
    const error = document.getElementById("error");
    error.textContent = "";

    // Validate characters
    for (let c of input) {
        if (
            !(c >= "A" && c <= "Z") &&
            c !== " " &&
            !allowedPunctuation.includes(c)
        ) {
            error.textContent = "Only letters, spaces, and . , ? ! ' are allowed.";
            return;
        }
    }

    // Count letters only
    const letterCount = input.split("").filter(c => c >= "A" && c <= "Z").length;
    if (letterCount < 5) {
        error.textContent = "Phrase must contain at least 5 letters.";
        return;
    }

    phrase = input;
    guessed = [];
    wrong = 0;
    maxWrong = parseInt(document.getElementById("maxWrong").value);

    hideAll();
    document.getElementById("game").classList.remove("hidden");

    drawPuzzle();
    drawKeyboard();
    updateFuse();
}

function hideAll() {
    ["setup","game","boomScreen","winScreen"].forEach(id =>
        document.getElementById(id).classList.add("hidden")
    );
}

function drawPuzzle() {
    let html = "";
    for (let char of phrase) {
        if (char === " ") {
            html += `<span class="word-gap"></span>`;
        } else if (allowedPunctuation.includes(char)) {
            html += `<span class="punctuation">${char}</span> `;
        } else if (guessed.includes(char)) {
            html += char + " ";
        } else {
            html += "_ ";
        }
    }
    document.getElementById("puzzle").innerHTML = html;
}

function drawKeyboard() {
    const kb = document.getElementById("keyboard");
    kb.innerHTML = "";
    letterButtons = {};

    const rows = [
        ["Q","W","E","R","T","Y","U","I","O","P"],
        ["A","S","D","F","G","H","J","K","L"],
        ["Z","X","C","V","B","N","M"]
    ];

    rows.forEach(row => {
        const rowDiv = document.createElement("div");
        rowDiv.style.display = "flex";
        rowDiv.style.justifyContent = "center";
        rowDiv.style.flexWrap = "wrap";
        rowDiv.style.gap = "5px";
        rowDiv.style.marginBottom = "6px";

        row.forEach(letter => {
            let btn = document.createElement("button");
            btn.textContent = letter;
            btn.onclick = () => guess(letter, btn);
            rowDiv.appendChild(btn);
            letterButtons[letter] = btn;
        });

        kb.appendChild(rowDiv);
    });
}


function guess(letter, btn) {
    btn.disabled = true;
    if (phrase.includes(letter)) {
        guessed.push(letter);
        btn.classList.add("correct");
    } else {
        wrong++;
        btn.classList.add("wrong");
        updateFuse();
    }
    drawPuzzle();
    checkEnd();
}

function updateFuse() {
    let percent = ((maxWrong - wrong) / maxWrong) * 100;
    document.getElementById("fuse").style.width = Math.max(0, percent) + "%";
}

function checkEnd() {
    if (wrong >= maxWrong) {
        hideAll();
        document.getElementById("boomScreen").classList.remove("hidden");
        document.getElementById("boomPhrase").textContent = phrase;
    } else if (
        phrase.split("").every(c =>
            c === " " ||
            allowedPunctuation.includes(c) ||
            guessed.includes(c)
        )
    ) {
        hideAll();
        document.getElementById("winScreen").classList.remove("hidden");
        document.getElementById("winPhrase").textContent = phrase;
    }
}

function resetGame() {
    phrase = "";
    guessed = [];
    wrong = 0;
    document.getElementById("secretInput").value = "";
    document.getElementById("error").textContent = "";
    hideAll();
    document.getElementById("setup").classList.remove("hidden");
}

populateSuggestions();

</script>

</body>
</html>
